<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Slide To√°n 16:9 ‚Äì M·∫´u tr√¨nh chi·∫øu</title>
  <meta name="description" content="M·∫´u slide HTML cho d·∫°y h·ªçc To√°n: 16:9, ph√≠m t·∫Øt, ti·∫øn ƒë·ªô, h·∫πn gi·ªù, MathJax, QR, ƒëi·ªÅu h∆∞·ªõng nhanh, t√™n GV."/>
  <!-- MathJax for LaTeX rendering (internet required) -->
  <script>
    window.MathJax = {
      tex: {inlineMath: [["$","$"],["\\(","\\)"]], displayMath: [["$$","$$"],["\\[","\\]"]]},
      svg: {fontCache: 'global'}
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  <style>
    :root{
      /* Ch·ªß ƒë·ªÅ s√°ng ‚Äì t·ªëi ∆∞u m√°y chi·∫øu ban ng√†y */
      --bg:#f2f3f5;          /* n·ªÅn x√°m nh·∫°t to√†n trang */
      --panel:#ffffff;       /* n·ªÅn th·∫ª n·ªôi dung */
      --text:#0d0f14;        /* ch·ªØ ch√≠nh r·∫•t ƒë·∫≠m */
      --muted:#3a4052;       /* ch·ªØ ph·ª• ƒë·∫≠m h∆°n ƒë·ªÉ t∆∞∆°ng ph·∫£n */
      --accent:#0b57d0;      /* xanh lam ƒë·∫≠m (d·ªÖ nh√¨n tr√™n m√°y chi·∫øu) */
      --math:#0b57d0;        /* m√†u c√¥ng th·ª©c to√°n (ƒë·ªìng b·ªô accent) */
      --tint:#f7f9ff;        /* n·ªÅn gradient nh·∫°t l·∫•y t·ª´ m√†u c√¥ng th·ª©c */
      --success:#137333;     /* xanh t√≠n hi·ªáu */
      --danger:#b80627;      /* ƒë·ªè t√≠n hi·ªáu */
      --warning:#a05a00;     /* v√†ng n√¢u */
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    .deck{position:fixed;inset:0;display:grid;place-items:center}
    .slide{width:calc(min(100vw, 1280px));aspect-ratio:16/9;background:linear-gradient(140deg,var(--tint) 0%, #f2f3f5 60%);border:1px solid rgba(13,15,20,.08);border-radius:24px;box-shadow:0 10px 40px rgba(0,0,0,.08);padding:48px;display:none}
    .slide.active{display:block}

    h1,h2{margin:0 0 16px}
    h1{font-size:56px;line-height:1.1;letter-spacing:.3px}
    h2{font-size:40px}
    p{font-size:26px;line-height:1.5;color:var(--muted)}
    .lead{font-size:28px;color:var(--text)}
    .grid{display:grid;gap:16px}
    .grid.cols-2{grid-template-columns:1fr 1fr}
    .card{background:var(--panel);border:1px solid rgba(13,15,20,.1);border-radius:20px;padding:24px;transition:border-color .2s ease, box-shadow .2s ease}
    .card:hover{border-color:var(--math);box-shadow:0 6px 20px rgba(0,0,0,.08)} 
    .tag{display:inline-block;padding:6px 12px;border-radius:999px;background:transparent;border:1.5px solid var(--math);color:var(--math);font-weight:800;font-size:14px;letter-spacing:.4px} 
    .big{font-size:32px}
    .formula{font-size:34px;margin:8px 0;padding:12px 16px;border-left:5px solid var(--math);border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.92));box-shadow:0 4px 12px rgba(0,0,0,.06)} 

    /* footer bar */
    .bar{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);width:calc(min(100vw, 1280px));display:flex;align-items:center;gap:16px}
    .progress{flex:1;height:8px;background:rgba(0,0,0,.08);border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#3b77e3);width:0%}
    .crumb{font-size:14px;color:var(--muted)}
    .timer{margin-left:auto;font-variant-numeric:tabular-nums;font-weight:700}

    /* black screen for pause */
    .blackout{position:fixed;inset:0;background:#000;display:none;z-index:30}
    .blackout.show{display:block}

    .kbd{padding:4px 8px;border-radius:6px;background:#f1f3f9;border:1px solid rgba(13,15,20,.2);color:#0d0f14;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:14px}
    .muted{color:var(--muted)}

    /* responsive text scale */
    @media (max-width: 1024px){
      .slide{padding:32px}
      h1{font-size:44px}
      h2{font-size:32px}
      p,.lead{font-size:22px}
      .formula{font-size:28px}
    }

    /* Hi·ªáu ·ª©ng xu·∫•t hi·ªán t·ª´ng n·ªôi dung (fragments) */
    .frag{opacity:0;transform:translateY(8px);transition:opacity .28s ease, transform .28s ease}
    .frag.shown{opacity:1;transform:none}

    /* TƒÉng t∆∞∆°ng ph·∫£n ch·ªØ khi tr√¨nh chi·∫øu */
    h1,h2,p,li,.formula{filter:contrast(110%)}

    /* M√†u cho c√¥ng th·ª©c MathJax */
    mjx-container{ color: var(--math); }

    /* High-contrast mode overrides */
    :root.hc{ --bg:#ffffff; --panel:#ffffff; --text:#000000; --muted:#111111; --accent:#000000; --math:#000000; --tint:#ffffff; }
    :root.hc .slide{ background:#fff; }
    :root.hc .formula{ background:#fff; box-shadow:none; border-left-color:#000 }
    :root.ui-off .controls, :root.ui-off .jumper{ display:none !important; }

    /* N√∫t nh·∫£y nhanh slide (g√≥c m√†n h√¨nh) */
    .jumper{position:fixed;top:64px;right:14px;display:flex;flex-wrap:wrap;gap:8px;max-width:min(40vw,520px);z-index:40} /* ƒë·∫©y xu·ªëng d∆∞·ªõi h√†ng n√∫t ƒëi·ªÅu khi·ªÉn ƒë·ªÉ kh√¥ng b·ªã che */
    @media (max-width: 768px){ .jumper{ top: 60px; } }
    .jump-btn{min-width:36px;min-height:36px;padding:6px 10px;border-radius:999px;border:1px solid rgba(13,15,20,.2);background:#fff;color:#0d0f14;font-weight:700;cursor:pointer;box-shadow:0 1px 2px rgba(0,0,0,.06)}
    .jump-btn[aria-current="true"]{background:var(--accent);color:#fff;border-color:transparent}

    /* Badge t√™n gi√°o vi√™n (g√≥c m√†n h√¨nh) */
    .teacher-badge{position:fixed;top:14px;left:14px;padding:8px 12px;border-radius:999px;background:#ffffff;border:1px solid rgba(13,15,20,.12);box-shadow:0 1px 2px rgba(0,0,0,.06);font-weight:700}
      
    /* ƒêi·ªÅu khi·ªÉn nhanh: full screen + b·∫£ng m√†u c√¥ng th·ª©c */
    .controls{position:fixed;top:14px;right:14px;display:flex;align-items:center;gap:10px;z-index:41}
    .fs-btn,.pal-btn{height:36px;min-width:36px;border-radius:999px;border:1px solid rgba(13,15,20,.2);background:#fff;color:#0d0f14;font-weight:700;cursor:pointer;box-shadow:0 1px 2px rgba(0,0,0,.06);display:inline-flex;align-items:center;justify-content:center;padding:0 10px}
    .fs-btn[aria-pressed="true"]{background:var(--accent);color:#fff}
    .pal-btn{width:36px;padding:0;border:2px solid #fff;outline:1px solid rgba(13,15,20,.25)}
    .pal-btn[aria-pressed="true"]{outline:2px solid var(--accent)}

      /* T√¥ m√†u c√°c m·ª•c ch√≠nh theo m√†u c√¥ng th·ª©c */
    h2, h3{ color: var(--math); }
    ul.big li::marker, ol.big li::marker{ color: var(--math); font-weight:800; }

      /* Web panel overlay (nh√∫ng web to√†n c·ª•c) */
    .webpanel{position:fixed;right:16px;bottom:76px;width:min(90vw,720px);height:min(70vh,480px);background:#fff;border:1px solid rgba(13,15,20,.15);border-radius:14px;box-shadow:0 14px 40px rgba(0,0,0,.16);overflow:hidden;display:none;z-index:45;resize:both}
    .webpanel.show{display:block}
    .webpanel header{height:40px;display:flex;align-items:center;justify-content:space-between;padding:0 10px;background:linear-gradient(180deg,#fff, #f6f7fb);border-bottom:1px solid rgba(13,15,20,.1)}
    .webpanel header .title{font-weight:700;font-size:14px;color:#0d0f14;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:70%}
    .webpanel header .actions{display:flex;gap:8px}
    .webpanel header button{height:28px;min-width:28px;padding:0 8px;border-radius:999px;border:1px solid rgba(13,15,20,.2);background:#fff;cursor:pointer}
    .webpanel iframe{width:100%;height:calc(100% - 40px);border:0}

      /* N√∫t ph·ª•c h·ªìi ƒëi·ªÅu khi·ªÉn khi ƒëang ·∫©n (UI Off) */
    .ui-restore{position:fixed;left:18px;bottom:22px;width:42px;height:42px;border-radius:999px;border:1px solid rgba(13,15,20,.2);background:#fff;color:#0d0f14;display:none;align-items:center;justify-content:center;z-index:50;box-shadow:0 2px 6px rgba(0,0,0,.12);cursor:pointer;font-size:20px}
    :root.ui-off .ui-restore{display:flex}

  </style>
</head>
<body>
  <!-- Badge t√™n GV -->
  <div class="teacher-badge">V≈© Ti·∫øn L·ª±c - NHC</div>
  <!-- D√£y n√∫t nh·∫£y nhanh -->
  <div class="controls" aria-label="ƒêi·ªÅu khi·ªÉn nhanh">
    <button class="fs-btn" id="fsBtn" type="button" title="To√†n m√†n h√¨nh (F)">‚õ∂</button>
    <button class="fs-btn" id="hcBtn" type="button" title="Ch·∫ø ƒë·ªô High-Contrast (H)">HC</button>
    <button class="fs-btn" id="uiToggleBtn" type="button" title="·∫®n/hi·ªán ƒëi·ªÅu khi·ªÉn (G)">‚ò∞</button>
    <button class="fs-btn" id="webBtn" type="button" title="Tr·ª±c quan Web (V)">üåê</button>
    <div style="display:flex;gap:8px" aria-label="B·∫£ng m√†u c√¥ng th·ª©c">
      <button class="pal-btn" id="pal-red" type="button" title="M√†u c√¥ng th·ª©c: ƒê·ªè (1)" style="background:#c62828"></button>
      <button class="pal-btn" id="pal-green" type="button" title="M√†u c√¥ng th·ª©c: Xanh (2)" style="background:#137333"></button>
      <button class="pal-btn" id="pal-purple" type="button" title="M√†u c√¥ng th·ª©c: T√≠m (3)" style="background:#6a1b9a"></button>
    </div>
  </div>
  <div class="jumper" id="jumper" aria-label="ƒêi·ªÅu h∆∞·ªõng nhanh c√°c slide"></div>

  <div class="deck" id="deck">

    <!-- 0. Trang b√¨a -->
    <section class="slide active" data-title="B√¨a">
      <span class="tag">To√°n 12 ¬∑ CTST</span>
      <h1>ƒê∆Ø·ªúNG TI·ªÜM C·∫¨N<br/>C·ª¶A ƒê·ªí TH·ªä H√ÄM S·ªê</h1>
      <p class="lead">B√†i gi·∫£ng t∆∞∆°ng t√°c ¬∑ C√≥ luy·ªán t·∫≠p & tr·∫Øc nghi·ªám</p>
      <div class="grid cols-2" style="margin-top:24px">
        <div class="card">
          <h2>M·ª•c ti√™u</h2>
          <ul class="big">
            <li>Nh·∫≠n bi·∫øt ti·ªám c·∫≠n ƒë·ª©ng, ngang, xi√™n.</li>
            <li>T√¨m ti·ªám c·∫≠n b·∫±ng gi·ªõi h·∫°n.</li>
            <li>V·∫≠n d·ª•ng v√†o ph√¢n t√≠ch ƒë·ªì th·ªã.</li>
          </ul>
        </div>
        <div class="card">
          <h2>Ph√≠m t·∫Øt</h2>
          <p><span class="kbd">‚Üê/‚Üí</span> chuy·ªÉn slide ¬∑ <span class="kbd">Space</span> hi·ªán t·ª´ng √Ω ¬∑ <span class="kbd">B</span> m√†n h√¨nh ƒëen ¬∑ <span class="kbd">T</span> b·∫≠t/t·∫Øt h·∫πn gi·ªù ¬∑ <span class="kbd">R</span> ƒë·∫∑t l·∫°i</p>
        </div>
      </div>
    </section>

    <!-- 1. Kh·ªüi ƒë·ªông (KWL / g·ª£i m·ªü) -->
    <section class="slide" data-title="Kh·ªüi ƒë·ªông" data-frag-auto>
      <span class="tag">Kh·ªüi ƒë·ªông üìå</span>
      <h2>C√≥ ƒë∆∞·ªùng n√†o m√† ta c√†ng ti·∫øn g·∫ßn c√†ng ‚Äúkh√¥ng bao gi·ªù ch·∫°m‚Äù?</h2>
      <div class="grid cols-2" style="margin-top:8px">
        <div class="card">
          <h3>KWL</h3>
          <ul class="big">
            <li><b>K</b> ‚Äì Em ƒë√£ bi·∫øt g√¨ v·ªÅ ‚Äúti·ªám c·∫≠n‚Äù?</li>
            <li><b>W</b> ‚Äì Em mu·ªën bi·∫øt ƒëi·ªÅu g√¨?</li>
            <li><b>L</b> ‚Äì Em h·ªçc ƒë∆∞·ª£c g√¨ (cu·ªëi gi·ªù)?</li>
          </ul>
        </div>
        <div class="card">
          <h3>G·ª£i m·ªü nhanh</h3>
          <p class="lead">V√≠ d·ª•: \(y=\frac{1}{x}\) khi \(x\to 0\) ‚Äì ƒë·ªì th·ªã ti·∫øn s√°t tr·ª•c Oy nh∆∞ng kh√¥ng c·∫Øt.</p>
        </div>
      </div>
    </section>

    <!-- 2. H√¨nh th√†nh ki·∫øn th·ª©c -->
    <section class="slide" data-title="Ki·∫øn th·ª©c m·ªõi" data-frag-auto>
      <span class="tag">Ki·∫øn th·ª©c m·ªõi üìò</span>
      <h2>ƒê·ªãnh nghƒ©a & ph√¢n lo·∫°i</h2>
      <div class="card">
        <p class="formula">‚Ä¢ <b>Ti·ªám c·∫≠n ƒë·ª©ng</b>: $$\lim_{x\to a} f(x)=\pm\infty \;\Rightarrow\; x=a$$</p>
        <p class="formula">‚Ä¢ <b>Ti·ªám c·∫≠n ngang</b>: $$\lim_{x\to \pm\infty} f(x)=b \;\Rightarrow\; y=b$$</p>
        <p class="formula">‚Ä¢ <b>Ti·ªám c·∫≠n xi√™n</b>: $$\lim_{x\to \pm\infty} \big(f(x)-(ax+b)\big)=0 \;\Rightarrow\; y=ax+b$$</p>
      </div>
    </section>

    <!-- 3. V√≠ d·ª• d·∫´n d·∫Øt -->
    <section class="slide" data-title="V√≠ d·ª•" data-frag-auto>
      <span class="tag">V√≠ d·ª• üß©</span>
      <h2>V√≠ d·ª• 1</h2>
      <div class="grid cols-2" style="margin-top:8px">
        <div class="card">
          <p class="lead"><b>H√†m:</b> \(f(x)=\dfrac{2x+1}{x-1}\)</p>
          <ul class="big">
            <li>TC ƒë·ª©ng: nghi·ªám m·∫´u s·ªë \(x=1\).</li>
            <li>TC ngang: so b·∫≠c ‚Äì h·ªá s·ªë ƒë·∫ßu: \(y=2\).</li>
          </ul>
        </div>
        <div class="card">
          <p class="lead"><b>Ki·ªÉm tra b·∫±ng gi·ªõi h·∫°n</b></p>
          <p>$$\lim_{x\to 1^\pm} f(x)=\pm\infty \Rightarrow x=1$$</p>
          <p>$$\lim_{x\to \pm\infty} f(x)=2 \Rightarrow y=2$$</p>
        </div>
      </div>
    </section>

    <!-- 4. Luy·ªán t·∫≠p (Coach) c√≥ b·∫≠t ƒë√°p √°n -->
    <section class="slide" data-title="Luy·ªán t·∫≠p 1" data-reveal data-frag-auto>
      <span class="tag">Luy·ªán t·∫≠p üß™</span>
      <h2>T√¨m c√°c ƒë∆∞·ªùng ti·ªám c·∫≠n c·ªßa \(y=\dfrac{x^2-1}{x-1}\)</h2>
      <div class="card">
        <ol class="big" id="q1">
          <li>R√∫t g·ªçn h√†m s·ªë.</li>
          <li>X√©t gi·ªõi h·∫°n khi \(x\to 1\) v√† \(x\to \pm\infty\).</li>
        </ol>
        <details class="big" style="margin-top:12px"><summary>üëÄ G·ª£i √Ω</summary>Nh·ªõ r·∫±ng \(x^2-1=(x-1)(x+1)\).</details>
        <div class="answer" hidden>
          <p>R√∫t g·ªçn: \(y=x+1\) v·ªõi \(x\ne 1\). V·∫≠y:</p>
          <ul class="big">
            <li>Kh√¥ng c√≥ TC ƒë·ª©ng theo bi·ªÉu th·ª©c r√∫t g·ªçn, nh∆∞ng do lo·∫°i ƒëi·ªÉm \(x=1\), ƒë·ªì th·ªã c√≥ <b>ti·ªám c·∫≠n l·ªó h·ªïng</b> t·∫°i \(x=1\) (ghi ch√∫ m·ªü r·ªông).</li>
            <li>TC xi√™n: \(y=x+1\) (v√¨ \(f(x)\to x+1\) khi \(x\to \pm\infty\)).</li>
          </ul>
        </div>
      </div>
      <p class="muted">Nh·∫•n <span class="kbd">Space</span> ƒë·ªÉ hi·ªán/·∫©n ƒë√°p √°n.</p>
    </section>

    <!-- 5. Tr·∫Øc nghi·ªám nhanh (Facilitator) -->
    <section class="slide" data-title="Tr·∫Øc nghi·ªám nhanh" data-frag-auto>
      <span class="tag">Tr·∫Øc nghi·ªám üìù</span>
      <h2>Mini-quiz: \(f(x)=\dfrac{3x-5}{x+2}\)</h2>
      <div class="grid cols-2">
        <div class="card">
          <ol class="big">
            <li>Ti·ªám c·∫≠n ƒë·ª©ng l√† g√¨?</li>
            <li>Ti·ªám c·∫≠n ngang l√† g√¨?</li>
          </ol>
          <details class="big" style="margin-top:8px"><summary>ƒê√°p √°n</summary>ƒê·ª©ng: \(x=-2\). Ngang: \(y=3\).</details>
        </div>
        <div class="card">
          <p class="lead">Qu√©t QR ƒë·ªÉ tr·∫£ l·ªùi tr·ª±c tuy·∫øn</p>
          <canvas id="qr" width="280" height="280" style="background:#fff;border-radius:12px"></canvas>
          <p class="muted">Thay li√™n k·∫øt trong JS: <code>QR_LINK</code></p>
        </div>
      </div>
    </section>

    <!-- 5b. Khung nh√∫ng web tr·ª±c quan -->
    <section class="slide" data-title="Tr·ª±c quan" data-frag-auto>
      <span class="tag">Khung tr·ª±c quan üåê</span>
      <h2>Khung nh√∫ng Web</h2>
      <div class="card">
        <p class="lead">D∆∞·ªõi ƒë√¢y l√† m·ªôt khung nh√∫ng ƒë·ªÉ hi·ªÉn th·ªã h√¨nh ·∫£nh/ƒë·ªì th·ªã tr·ª±c quan t·ª´ m·ªôt trang web b√™n ngo√†i (v√≠ d·ª•: GeoGebra, Desmos, YouTube,...)</p>
        <iframe id="demoFrame" src="https://www.geogebra.org/m/p9w2fp6j" width="100%" height="400" style="border:1px solid var(--math);border-radius:12px"></iframe>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <button class="fs-btn" type="button" data-open-webpanel>üîé M·ªü khung tr·ª±c quan</button>
          <button class="fs-btn" type="button" data-set-weburl>üîó ƒê·ªïi URL‚Ä¶</button>
        </div>
        <p class="muted">üîó Thay URL trong n√∫t ‚Äúƒê·ªïi URL‚Ä¶‚Äù ho·∫∑c s·ª≠a tr·ª±c ti·∫øp th·∫ª <code>&lt;iframe id="demoFrame"&gt;</code>.</p>
      </div>
    </section>

    <!-- 6. T·ªïng k·∫øt -->
    <section class="slide" data-title="T·ªïng k·∫øt" data-frag-auto>
      <span class="tag">T·ªïng k·∫øt ‚úÖ</span>
      <h2>Em r√∫t ra g√¨ h√¥m nay?</h2>
      <ul class="big">
        <li>Nh·∫≠n d·∫°ng: ƒë·ª©ng ‚Äì ngang ‚Äì xi√™n.</li>
        <li>Ph∆∞∆°ng ph√°p: d√πng gi·ªõi h·∫°n / so b·∫≠c.</li>
        <li>·ª®ng d·ª•ng: ph√°c th·∫£o ƒë·ªì th·ªã nhanh.</li>
      </ul>
      <p class="muted">Exit ticket: Vi·∫øt 1 v√≠ d·ª• c√≥ c·∫£ TC ƒë·ª©ng v√† ngang.</p>
    </section>

  </div>

  <!-- bottom bar -->
  <div class="bar" aria-hidden="true">
    <div class="crumb" id="crumb">1 / 7 ¬∑ B√¨a</div>
    <div class="progress"><span id="prog"></span></div>
    <div class="timer" id="timer">00:00</div>
  </div>

  <div class="blackout" id="blackout"></div>
  <!-- N√∫t ph·ª•c h·ªìi UI khi ƒë√£ ·∫©n b·∫±ng ph√≠m G -->
  <button class="ui-restore" id="uiRestore" title="Hi·ªán ƒëi·ªÅu khi·ªÉn (G)">‚öôÔ∏è</button>

  <!-- Webpanel overlay -->
  <div class="webpanel" id="webpanel" role="dialog" aria-label="Khung tr·ª±c quan">
    <header>
      <span class="title" id="webTitle">Tr·ª±c quan Web</span>
      <div class="actions">
        <button id="webOpen" title="M·ªü tab m·ªõi">‚Üó</button>
        <button id="webClose" title="ƒê√≥ng">‚úï</button>
      </div>
    </header>
    <iframe id="webframe" src="" allowfullscreen referrerpolicy="strict-origin-when-cross-origin"></iframe>
  </div>

  <script>
    // ======== Minimal slide engine (arrows, space to reveal, progress, timer, B to blackout) ========
    const slides = [...document.querySelectorAll('.slide')];
    let idx = 0; 
    const prog = document.getElementById('prog');
    const crumb = document.getElementById('crumb');
    const blackout = document.getElementById('blackout');

    // ======== Build slide jumper buttons ========
    const jumper = document.getElementById('jumper');
    function buildJumper(){
      jumper.innerHTML = '';
      slides.forEach((s,i)=>{
        const b = document.createElement('button');
        b.className = 'jump-btn';
        b.type = 'button';
        b.textContent = String(i+1);
        b.title = (s.dataset.title||'Slide')+` (#${i+1})`;
        b.addEventListener('click',()=> setActive(i));
        jumper.appendChild(b);
      });
      updateJumperActive();
    }
    function updateJumperActive(){
      const btns = jumper.querySelectorAll('.jump-btn');
      btns.forEach((b,i)=> b.setAttribute('aria-current', i===idx ? 'true' : 'false'));
    }

    function prepareFragments(slide){
      slide.querySelectorAll('.frag').forEach(el=>el.classList.remove('shown'));
      if(slide.hasAttribute('data-frag-auto')){
        const targets = slide.querySelectorAll('li, .formula, p.lead, details, .answer li');
        targets.forEach(el=>el.classList.add('frag'));
      }
    }
    function nextFrag(){
      const s = slides[idx];
      const f = s.querySelector('.frag:not(.shown)');
      if(f){ f.classList.add('shown'); return true; }
      return false;
    }

    function setActive(i){
      slides[idx].classList.remove('active');
      idx = Math.max(0, Math.min(slides.length-1, i));
      slides[idx].classList.add('active');
      const title = slides[idx].dataset.title || 'Slide';
      crumb.textContent = `${idx+1} / ${slides.length} ¬∑ ${title}`;
      prog.style.width = ((idx+1)/slides.length*100)+'%';
      prepareFragments(slides[idx]);
      updateJumperActive();
    }

    function next(){
      const s = slides[idx];
      if(nextFrag()) return; // hi·ªán t·ª´ng n·ªôi dung
      if(s.hasAttribute('data-reveal')){
        const ans = s.querySelector('.answer');
        if(ans && ans.hasAttribute('hidden')){ ans.hidden = false; return; }
      }
      setActive(idx+1);
    }
    function prev(){ setActive(idx-1); }

    document.addEventListener('keydown',e=>{
      const k = e.key.toLowerCase();
      if(k==='h'){ e.preventDefault(); toggleHC(); }
      if(k==='g'){ e.preventDefault(); toggleUI(); }
      if(k==='f'){ e.preventDefault(); toggleFs(); }
      if(k==='v'){ e.preventDefault(); toggleWebPanel(); }
      if(k==='c'){ e.preventDefault(); cycleColor(); }
      if(e.key==='1'){ e.preventDefault(); setMathColor('#c62828'); }
      if(e.key==='2'){ e.preventDefault(); setMathColor('#137333'); }
      if(e.key==='3'){ e.preventDefault(); setMathColor('#6a1b9a'); }
      if(['arrowright','pagedown',' '].includes(k)) { e.preventDefault(); next(); }
      if(['arrowleft','pageup'].includes(k)) { e.preventDefault(); prev(); }
      if(k==='b'){ blackout.classList.toggle('show'); }
      if(k==='t'){ toggleTimer(); }
      if(k==='r'){ resetTimer(); }
      if(k==='/' || (e.shiftKey && e.key==='?')){ e.preventDefault();
        alert('Ph√≠m: ‚Üê/‚Üí | Space | B | T | R | F = Fullscreen | H = High-Contrast | G = ·∫®n/hi·ªán ƒëi·ªÅu khi·ªÉn | V = Khung tr·ª±c quan | C = xoay m√†u | 1/2/3 = ƒê·ªè/Xanh/T√≠m | #N = nh·∫£y t·ªõi slide N');
      }
    });
    document.addEventListener('click', (e)=>{
      const tag = (e.target.tagName||'').toLowerCase();
      if(tag==='a' || tag==='summary' || e.target.closest('details')) return;
      next();
    });

    // ======== Simple timer (toggle with T) ========
    const timerEl = document.getElementById('timer');
    let tOn=false, t0=0, rafId=null;
    function fmt(ms){ const s=Math.floor(ms/1000); const m=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); return `${m}:${ss}` }
    function tick(){ timerEl.textContent = fmt(performance.now()-t0); rafId=requestAnimationFrame(tick) }
    function toggleTimer(){ tOn=!tOn; if(tOn){ t0=performance.now(); tick(); } else { cancelAnimationFrame(rafId); } }
    function resetTimer(){ cancelAnimationFrame(rafId); tOn=false; timerEl.textContent='00:00'; }

    // ======== Tiny QR to Canvas (no external lib) ========
    const QR_LINK = 'https://forms.gle/your-quiz-link';
    (function drawFakeQR(){
      const c=document.getElementById('qr'); if(!c) return; const g=c.getContext('2d');
      g.fillStyle='#fff'; g.fillRect(0,0,c.width,c.height);
      g.fillStyle='#000';
      const n=21, s=Math.floor(c.width/n);
      for(let y=0;y<n;y++){
        for(let x=0;x<n;x++){
          const v = (x*y + x + y) % 3 === 0 || (x<7&&y<7) || (x>n-8&&y<7) || (x<7&&y>n-8);
          if(v) g.fillRect(x*s+2,y*s+2,s-4,s-4);
        }
      }
      g.fillStyle='#111';
      g.fillRect(0,c.height-32,c.width,32);
      g.fillStyle='#fff';
      g.font='14px ui-monospace,monospace';
      g.fillText(QR_LINK,10,c.height-10);
    })();

    // ======== Hash navigation (#N => slide N) ========
    function parseHash(h){
      const m = String(h||location.hash).match(/^#(\d{1,3})$/);
      if(!m) return null;
      const n = parseInt(m[1],10);
      if(n>=1 && n<=slides.length) return n-1;
      return null;
    }
    window.addEventListener('hashchange',()=>{
      const n = parseHash();
      if(n!==null) setActive(n);
    });

    // ======== Self-tests (console) ========
    (function selfTest(){
      const TESTS = [
        {name:'parseHash valid', run:()=> parseHash('#3')===2},
        {name:'parseHash invalid', run:()=> parseHash('#x')===null},
        {name:'parseHash out-of-range', run:()=> parseHash('#0')===null && parseHash('#999')===null},
        {name:'setActive bounds', run:()=>{ const before=idx; setActive(0); const a=(idx===0); setActive(1000); const b=(idx===slides.length-1); setActive(before); return a&&b; }},
        {name:'fragment auto marks', run:()=>{ const s=slides.find(sl=>sl.hasAttribute('data-frag-auto')); if(!s) return true; prepareFragments(s); return s.querySelectorAll('.frag').length>0; }},
        // controls/tests
        {name:'controls exist', run:()=> !!document.getElementById('fsBtn') && !!document.getElementById('hcBtn') && !!document.getElementById('uiToggleBtn') && !!document.getElementById('webBtn')},
        {name:'uiRestore visible when off', run:()=>{ const root=document.documentElement; const had=root.classList.contains('ui-off'); root.classList.add('ui-off'); const visible=getComputedStyle(document.getElementById('uiRestore')).display!=='none'; if(!had) root.classList.remove('ui-off'); return visible; }},
        {name:'jumper exists once', run:()=> document.querySelectorAll('#jumper').length===1},
        {name:'setMathColor updates CSS var', run:()=>{ const before = getComputedStyle(document.documentElement).getPropertyValue('--math').trim(); setMathColor('#137333'); const after = getComputedStyle(document.documentElement).getPropertyValue('--math').trim(); setMathColor(before); return after==='#137333'; }},
        {name:'jumper has all buttons', run:()=> document.querySelectorAll('#jumper .jump-btn').length === document.querySelectorAll('.slide').length},
        {name:'webpanel API exists', run:()=> typeof toggleWebPanel==='function' && typeof setWebUrl==='function'},
      ];
      let pass=0; TESTS.forEach(t=>{ try{ const ok=t.run(); if(ok){ console.log('TEST PASS:',t.name);} else { console.error('TEST FAIL:',t.name);} pass+=ok?1:0; } catch(e){ console.error('TEST ERROR:',t.name,e);} });
      if(pass!==TESTS.length){ console.warn(`Self-tests: ${pass}/${TESTS.length} passed`); }
    })();

    // ======== Fullscreen, High-Contrast, UI Toggle, Palette & Tint ========
    const fsBtn = document.getElementById('fsBtn');
    function isFs(){ return document.fullscreenElement!=null; }
    async function toggleFs(){
      try{
        if(!isFs()) { await document.documentElement.requestFullscreen(); }
        else { await document.exitFullscreen(); }
      }catch(e){ console.warn('Fullscreen error', e); }
      fsBtn.setAttribute('aria-pressed', String(isFs()));
    }
    fsBtn.addEventListener('click', toggleFs);
    document.addEventListener('fullscreenchange', ()=>{
      fsBtn.setAttribute('aria-pressed', String(isFs()));
    });

    // High-Contrast toggle & persist
    const hcBtn = document.getElementById('hcBtn');
    function applyHC(on){
      document.documentElement.classList.toggle('hc', !!on);
      hcBtn.setAttribute('aria-pressed', on? 'true':'false');
      try{ localStorage.setItem('hc', on? '1':'0'); }catch{}
    }
    function toggleHC(){ applyHC(!document.documentElement.classList.contains('hc')); }
    hcBtn.addEventListener('click', toggleHC);

    // UI controls hide/show
    const uiToggleBtn = document.getElementById('uiToggleBtn');
    const uiRestore = document.getElementById('uiRestore');
    function applyUIOff(off){
      document.documentElement.classList.toggle('ui-off', !!off);
      uiToggleBtn.setAttribute('aria-pressed', off? 'true':'false');
      try{ localStorage.setItem('uiOff', off? '1':'0'); }catch{}
    }
    function toggleUI(){ applyUIOff(!document.documentElement.classList.contains('ui-off')); }
    uiToggleBtn.addEventListener('click', toggleUI);
    uiRestore.addEventListener('click', toggleUI);

    const palBtns = {
      red: document.getElementById('pal-red'),
      green: document.getElementById('pal-green'),
      purple: document.getElementById('pal-purple')
    };
    function setMathColor(hex){
      document.documentElement.style.setProperty('--math', hex);
      document.documentElement.style.setProperty('--accent', hex); // ƒë·ªìng b·ªô m√†u ƒëi·ªÉm nh·∫•n
      // t·∫°o m√†u n·ªÅn nh·∫°t (tint) t·ª´ m√†u c√¥ng th·ª©c
      const tint = ((()=>{
        function hexToRgb(h){
          const m = h.replace('#','');
          const mm = (m.length===3) ? m.split('').map(c=>c+c).join('') : m;
          const bigint = parseInt(mm, 16);
          return {r:(bigint>>16)&255, g:(bigint>>8)&255, b:bigint&255};
        }
        function toHex(n){ return n.toString(16).padStart(2,'0'); }
        const {r,g,b} = hexToRgb(hex);
        const a = 0.10; // 10% m√†u + 90% tr·∫Øng
        const rr = Math.round(255*(1-a) + r*a);
        const gg = Math.round(255*(1-a) + g*a);
        const bb = Math.round(255*(1-a) + b*a);
        return `#${toHex(rr)}${toHex(gg)}${toHex(bb)}`;
      })());
      document.documentElement.style.setProperty('--tint', tint);
      // l∆∞u l·ª±a ch·ªçn
      try{ localStorage.setItem('mathColor', hex); }catch{}
      // c·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
      Object.entries(palBtns).forEach(([key,btn])=>{
        const c = btn.style.background;
        btn.setAttribute('aria-pressed', (c===hex)?'true':'false');
      });
    }
    // g√°n s·ª± ki·ªán n√∫t m√†u
    palBtns.red.addEventListener('click', ()=> setMathColor('#c62828'));
    palBtns.green.addEventListener('click', ()=> setMathColor('#137333'));
    palBtns.purple.addEventListener('click', ()=> setMathColor('#6a1b9a'));

    // ph√≠m t·∫Øt m√†u: 1-ƒë·ªè, 2-xanh, 3-t√≠m, C: xoay v√≤ng
    const PALETTE = ['#c62828','#137333','#6a1b9a'];
    function cycleColor(){
      const cur = getComputedStyle(document.documentElement).getPropertyValue('--math').trim();
      const i = Math.max(0, PALETTE.indexOf(cur));
      const next = PALETTE[(i+1)%PALETTE.length];
      setMathColor(next);
    }

    // ======== Webpanel logic ========
    const webBtn   = document.getElementById('webBtn');
    const webpanel = document.getElementById('webpanel');
    const webframe = document.getElementById('webframe');
    const webTitle = document.getElementById('webTitle');
    const webOpen  = document.getElementById('webOpen');
    const webClose = document.getElementById('webClose');

    const DEFAULT_WEB_URL = (document.getElementById('demoFrame')?.getAttribute('src')) || 'https://www.geogebra.org/m/p9w2fp6j';

    function applyWebUrl(u){
      webTitle.textContent = u;
      if(webpanel.classList.contains('show')){
        try{ webframe.src = u; }catch{}
      }
      try{ localStorage.setItem('webUrl', u); }catch{}
    }
    function setWebUrl(u){
      if(!u) return;
      if(!/^https?:\/\//i.test(u)) { alert('URL ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng http:// ho·∫∑c https://'); return; }
      applyWebUrl(u);
    }
    function toggleWebPanel(force){
      const on = (typeof force==='boolean') ? force : !webpanel.classList.contains('show');
      webpanel.classList.toggle('show', on);
      webBtn.setAttribute('aria-pressed', on? 'true':'false');
      if(on){
        const u = (localStorage.getItem('webUrl')) || DEFAULT_WEB_URL;
        if(!webframe.src) webframe.src = u;
        webTitle.textContent = u;
      }
      try{ localStorage.setItem('webShow', on? '1':'0'); }catch{}
    }

    webBtn.addEventListener('click', ()=> toggleWebPanel());
    webClose.addEventListener('click', ()=> toggleWebPanel(false));
    webOpen.addEventListener('click', ()=>{
      const u = webframe.src || localStorage.getItem('webUrl') || DEFAULT_WEB_URL;
      window.open(u, '_blank');
    });

    // N√∫t trong slide: m·ªü panel / ƒë·ªïi URL
    document.addEventListener('click', (e)=>{
      const openBtn = e.target.closest('[data-open-webpanel]');
      if(openBtn){ e.preventDefault(); toggleWebPanel(true); return; }
      const setBtn = e.target.closest('[data-set-weburl]');
      if(setBtn){ e.preventDefault(); const cur = localStorage.getItem('webUrl') || document.getElementById('demoFrame')?.getAttribute('src') || DEFAULT_WEB_URL; const u = prompt('Nh·∫≠p URL mu·ªën nh√∫ng', cur); if(u) setWebUrl(u); return; }
    });

    // ======== Icons before H2 based on data-title ========
    (function addTitleIcons(){
      const iconMap = {
        'Kh·ªüi ƒë·ªông':'üìå','Ki·∫øn th·ª©c m·ªõi':'üìò','V√≠ d·ª•':'üß©','Luy·ªán t·∫≠p 1':'üß™','Luy·ªán t·∫≠p':'üß™','Tr·∫Øc nghi·ªám nhanh':'üìù','Tr·∫Øc nghi·ªám':'üìù','T·ªïng k·∫øt':'‚úÖ','B√¨a':'üéì'
      };
      slides.forEach(sl=>{
        const h2 = sl.querySelector('h2');
        if(!h2) return;
        const t = sl.dataset.title || h2.textContent.trim();
        const ico = iconMap[t] || '';
        if(ico && !h2.querySelector('.h2-ico')){
          const span=document.createElement('span');
          span.className='h2-ico';
          span.textContent=ico+' ';
          h2.prepend(span);
        }
      });
    })();

    // ======== init (use hash if provided) ========
    buildJumper();
    // √°p d·ª•ng c√†i ƒë·∫∑t ƒë√£ l∆∞u
    try{
      const savedColor = localStorage.getItem('mathColor');
      if(savedColor) setMathColor(savedColor);
      else setMathColor(getComputedStyle(document.documentElement).getPropertyValue('--math').trim());
      const savedHC = localStorage.getItem('hc');
      if(savedHC==='1') applyHC(true);
      const savedUiOff = localStorage.getItem('uiOff');
      if(savedUiOff==='1') applyUIOff(true);
      const savedUrl = localStorage.getItem('webUrl');
      applyWebUrl(savedUrl || DEFAULT_WEB_URL);
      const savedShow = localStorage.getItem('webShow');
      if(savedShow==='1') toggleWebPanel(true);
    }catch{ setMathColor(getComputedStyle(document.documentElement).getPropertyValue('--math').trim()); }

    const initial = parseHash();
    setActive(initial ?? 0);
  </script>
</body>
</html>
