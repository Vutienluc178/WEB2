<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tool Menu Studio ‚Äî sinh tools/index.json</title>
<style>
  :root{--fg:#1f2937;--bg:#f8fafc;--card:#ffffff;--border:#e5e7eb;--muted:#6b7280;--primary:#2563eb}
  *{box-sizing:border-box} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--fg)}
  header{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--border);padding:10px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between}
  header h1{font-size:18px;margin:0} header .actions{display:flex;gap:8px;flex-wrap:wrap}
  .btn{border:1px solid var(--border);background:var(--card);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn.primary{background:var(--primary);color:#fff;border-color:transparent}
  .container{max-width:1100px;margin:18px auto;padding:0 16px;display:grid;grid-template-columns: 1.3fr .7fr;gap:16px}
  .left,.right{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px}
  h2{margin:.2rem 0 1rem 0;font-size:18px}
  .group{border:1px dashed var(--border);border-radius:12px;padding:10px;margin:10px 0;background:#fff}
  .group-head{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .group-head input{flex:1;min-width:240px;padding:8px;border:1px solid var(--border);border-radius:10px}
  .items{margin-top:8px}
  .item{border-left:3px solid var(--border);padding:8px;margin:8px 0;background:#fafafa;border-radius:8px}
  .item .row{display:grid;grid-template-columns: 1fr 1fr auto;gap:8px}
  .item input{padding:8px;border:1px solid var(--border);border-radius:10px;width:100%}
  .toolbar{display:flex;gap:6px;flex-wrap:wrap}
  .muted{color:var(--muted);font-size:13px}
  textarea{width:100%;min-height:240px;padding:10px;border:1px solid var(--border);border-radius:10px;background:#0b1020;color:#e5e7eb;font-family:ui-monospace, SFMono-Regular, Menlo, monospace}
  .hint{font-size:13px;color:var(--muted);margin-top:6px}
  .danger{color:#b91c1c}
  .ok{color:#065f46}
  .grid-actions{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
  .hr{height:1px;background:var(--border);margin:10px 0}
  .bad{outline:2px solid #ef4444}
  @media(max-width:980px){.container{grid-template-columns:1fr;}}
</style>
</head>
<body>
<header>
  <h1>Tool Menu Studio ‚Äî sinh tools/index.json</h1>
  <div class="actions">
    <label class="btn">
      üìÇ M·ªü index.json
      <input id="fileInput" type="file" accept=".json" hidden>
    </label>
    <button id="loadMySample" class="btn">‚ú® N·∫°p m·∫´u c·ªßa t√¥i</button>
    <button id="newEmpty"  class="btn">üßº T·∫°o menu tr·ªëng</button>
    <button id="exportBtn" class="btn primary">üíæ T·∫£i xu·ªëng index.json</button>
  </div>
</header>

<div class="container">
  <section class="left">
    <h2>Danh m·ª•c nh√≥m & c√¥ng c·ª•</h2>
    <div class="grid-actions">
      <button id="addGroup" class="btn">‚ûï Th√™m nh√≥m</button>
      <span class="muted">M·∫πo: d√πng c√°c n√∫t ‚¨ÜÔ∏è‚¨áÔ∏è ƒë·ªÉ s·∫Øp x·∫øp nh√≥m/m·ª•c.</span>
    </div>
    <div id="groups"></div>
  </section>

  <aside class="right">
    <h2>Xu·∫•t / Ki·ªÉm tra</h2>
    <button id="refreshJSON" class="btn">üîÑ C·∫≠p nh·∫≠t JSON</button>
    <div class="hint">Nh·∫•n ƒë·ªÉ ƒë·ªìng b·ªô n·ªôi dung b√™n tr√°i sang JSON.</div>
    <div class="hr"></div>
    <textarea id="output" readonly></textarea>
    <div id="issues" class="hint"></div>
    <div class="hint">‚ö†Ô∏è C√≥ th·ªÉ ƒë·ªÉ nguy√™n <b>d·∫•u/kho·∫£ng tr·∫Øng</b> trong <code>path</code> n·∫øu th·∫ßy mu·ªën gi·ªØ ƒë√∫ng t√™n file tr√™n repo.</div>
  </aside>
</div>

<script>
  // ====== State ======
  let groups = []; // [{group, items: [{title, path}]}]

  // ====== Helpers ======
  const el = sel => document.querySelector(sel);
  const mk = (tag, props={}) => Object.assign(document.createElement(tag), props);
  function download(name, text){
    const blob = new Blob([text], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = mk('a',{href:url,download:name}); document.body.appendChild(a);
    a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  function moveInArray(arr, from, to){
    if(to<0 || to>=arr.length) return;
    const [sp] = arr.splice(from,1);
    arr.splice(to,0,sp);
  }
  // slug (tu·ª≥ ch·ªçn): b·ªè d·∫•u, th∆∞·ªùng ho√°
  function toSlug(s){
    return s.normalize('NFD').replace(/[\u0300-\u036f]/g,'')
            .toLowerCase()
            .replace(/[^a-z0-9\-_\s/]+/g,'')
            .replace(/\s+/g,'-')
            .replace(/-+/g,'-')
            .replace(/\/+/g,'/')
            .replace(/^-|-$/g,'');
  }

  // ====== Render ======
  const $groups = el('#groups');

  function render(){
    $groups.innerHTML = '';
    groups.forEach((g, gi)=>{
      const box = mk('div', {className:'group'});

      // header
      const head = mk('div', {className:'group-head'});
      const input = mk('input', {value: g.group || '', placeholder:'T√™n nh√≥m (VD: üî¢ L·ªõp 10)'});
      input.addEventListener('input', ()=> g.group = input.value.trim());
      head.appendChild(input);

      const tb = mk('div', {className:'toolbar'});
      const up = mk('button',{className:'btn', textContent:'‚¨ÜÔ∏è'});
      const down = mk('button',{className:'btn', textContent:'‚¨áÔ∏è'});
      const addItemBtn = mk('button',{className:'btn', textContent:'‚ûï Th√™m tool'});
      const del = mk('button',{className:'btn', textContent:'üóëÔ∏è Xo√° nh√≥m'});
      up.onclick = ()=>{ moveInArray(groups, gi, gi-1); render(); };
      down.onclick = ()=>{ moveInArray(groups, gi, gi+1); render(); };
      del.onclick = ()=>{ if(confirm('Xo√° nh√≥m n√†y?')){ groups.splice(gi,1); render(); } };
      addItemBtn.onclick = ()=>{ g.items.push({title:'', path:''}); render(); };
      tb.append(up, down, addItemBtn, del);
      head.appendChild(tb);
      box.appendChild(head);

      // items
      const itemsWrap = mk('div',{className:'items'});
      (g.items || []).forEach((it, ii)=>{
        const row = mk('div',{className:'item'});
        const grid = mk('div',{className:'row'});

        const tInput = mk('input',{value: it.title || '', placeholder:'Ti√™u ƒë·ªÅ'});
        const pInput = mk('input',{value: it.path  || '', placeholder:'lop10/ten-tool.html'});
        const btns = mk('div',{className:'toolbar'});
        const auto = mk('button',{className:'btn',textContent:'üîß T·∫°o path t·ª´ ti√™u ƒë·ªÅ'});
        const upI = mk('button',{className:'btn',textContent:'‚¨ÜÔ∏è'});
        const downI = mk('button',{className:'btn',textContent:'‚¨áÔ∏è'});
        const delI = mk('button',{className:'btn',textContent:'üóëÔ∏è'});

        tInput.oninput = ()=> it.title = tInput.value.trim();
        pInput.oninput = ()=> it.path  = pInput.value.trim();

        auto.onclick = ()=>{
          // ƒëo√°n th∆∞ m·ª•c theo group
          const gName = (g.group||'').toLowerCase();
          let base = '';
          if(gName.includes('l·ªõp 10')) base = 'lop10/';
          else if(gName.includes('l·ªõp 11')) base = 'lop11/';
          else if(gName.includes('l·ªõp 12')) base = 'lop12/';
          else if(gName.includes('gvcn')) base = 'gvcn/';
          else if(gName.includes('ti·ªán √≠ch') || gName.includes('tien ich')) base = 'tien-ich/';
          const slug = toSlug(tInput.value||'cong-cu');
          pInput.value = base + slug + '.html';
          it.path = pInput.value;
        };
        upI.onclick   = ()=>{ moveInArray(g.items, ii, ii-1); render(); };
        downI.onclick = ()=>{ moveInArray(g.items, ii, ii+1); render(); };
        delI.onclick  = ()=>{ g.items.splice(ii,1); render(); };

        grid.append(tInput, pInput, btns);
        btns.append(auto, upI, downI, delI);
        row.appendChild(grid);
        itemsWrap.appendChild(row);
      });

      box.appendChild(itemsWrap);
      $groups.appendChild(box);
    });
    refreshJSON();
  }

  // ====== JSON I/O ======
  function refreshJSON(){
    const issues = [];
    const out = [];
    const pathSet = new Set();

    function markBad(input){
      input.classList.add('bad'); setTimeout(()=>input.classList.remove('bad'), 1200);
    }

    const groupBoxes = $groups.querySelectorAll('.group');
    groupBoxes.forEach((box, gi)=>{
      const nameInput = box.querySelector('.group-head input');
      const groupName = nameInput.value.trim();
      const itemNodes = box.querySelectorAll('.item');

      const items = [];
      itemNodes.forEach((node)=>{
        const [ti, pi] = node.querySelectorAll('input');
        const title = ti.value.trim();
        const path  = pi.value.trim();

        if(!title){ issues.push('Thi·∫øu ti√™u ƒë·ªÅ ·ªü 1 m·ª•c'); markBad(ti); }
        if(!path){ issues.push('Thi·∫øu ƒë∆∞·ªùng d·∫´n ·ªü 1 m·ª•c'); markBad(pi); }

        if(path){
          if(pathSet.has(path)){
            issues.push(`Tr√πng path: ${path}`); markBad(pi);
          } else {
            pathSet.add(path);
          }
        }
        if(title && path) items.push({title, path});
      });

      if(!groupName && items.length>0){
        issues.push('C√≥ nh√≥m ch∆∞a ƒë·∫∑t t√™n'); markBad(nameInput);
      }
      if(groupName && items.length>0){
        out.push({group: groupName, items});
      }
    });

    el('#output').value = JSON.stringify(out, null, 2);
    const $issues = el('#issues');
    if(issues.length){
      $issues.innerHTML = '‚ö†Ô∏è ' + [...new Set(issues)].join(' ¬∑ ');
      $issues.className = 'hint danger';
    }else{
      $issues.textContent = '‚úî Kh√¥ng ph√°t hi·ªán l·ªói c∆° b·∫£n.';
      $issues.className = 'hint ok';
    }
  }

  function loadFromJSON(data){
    if(!Array.isArray(data)) throw new Error('JSON ph·∫£i l√† m·∫£ng c√°c nh√≥m');
    groups = data.map(g=>({
      group: g.group || '',
      items: Array.isArray(g.items) ? g.items.map(x=>({title:x.title||'', path:x.path||''})) : []
    }));
    render();
  }

  // ====== M·∫™U C·ª¶A TH·∫¶Y ======
  function mySample(){
    return [
      {
        "group": "üî¢ L·ªõp 10",
        "items": [
          {"title":"ƒê·ªäNH NGHƒ®A VECTO","path":"lop10/hinh-hoc-vecto.html"},
          {"title":"C√ÅC PH√âP TO√ÅN T·∫¨P H·ª¢P","path":"lop10/ƒëaÃ£i soÃÇÃÅ -CAÃÅC PHEÃÅP TOAÃÅN TREÃÇN TAÃ£ÃÇP HOÃõÃ£P.html"},
          {"title":"Gi·∫£i ph∆∞∆°ng tr√¨nh b·∫≠c hai","path":"lop10/pt-bac-hai.html"},
          {"title":"H·ªá ph∆∞∆°ng tr√¨nh 2√ó2","path":"lop10/he-pt-2x2.html"},
          {"title":"ƒê·ªì th·ªã y = ax + b","path":"lop10/ham-bac-nhat-plot.html"}
        ]
      },
      {
        "group": "üìê L·ªõp 11",
        "items": [
          {"title":"Tam gi√°c & L∆∞·ª£ng gi√°c","path":"lop11/tam-giac-trigon.html"},
          {"title":"C·∫•p s·ªë c·ªông","path":"lop11/cap-so-cong.html"}
        ]
      },
      {
        "group": "üßÆ L·ªõp 12",
        "items": [
          {"title":"T·ªï h·ª£p & X√°c su·∫•t","path":"lop12/to-hop-xac-suat.html"},
          {"title":"Gi·ªõi h·∫°n ƒë∆°n gi·∫£n","path":"lop12/gioi-han-don-gian.html"}
        ]
      },
      {
        "group": "üë®‚Äçüè´ GVCN",
        "items": [
          {"title":"V√íNG QUAY K√å DI·ªÜU","path":"tien-ich/chieÃÇÃÅc noÃÅn kiÃÄ dieÃ£ÃÇu.html"},
          {"title":"Pomodoro 25/5","path":"gvcn/pomodoro.html"}
        ]
      },
      {
        "group": "üß∞ Ti·ªán √≠ch",
        "items": [
          {"title":"T·∫°o menu WEB","path":"tien-ich/TAÃÅOJSON.html"}
        ]
      }
    ];
  }

  // ====== Events ======
  el('#addGroup').onclick   = ()=>{ groups.push({group:'', items:[]}); render(); };
  el('#refreshJSON').onclick= refreshJSON;
  el('#exportBtn').onclick  = ()=> download('index.json', el('#output').value || '[]');
  el('#newEmpty').onclick   = ()=>{ if(confirm('T·∫°o menu tr·ªëng?')){ groups=[]; render(); } };
  el('#loadMySample').onclick = ()=>{ if(confirm('N·∫°p m·∫´u c·ªßa th·∫ßy? D·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã thay.')){ groups=mySample(); render(); } };

  el('#fileInput').addEventListener('change', (e)=>{
    const f = e.target.files[0]; if(!f) return;
    const rd = new FileReader();
    rd.onload = ev=>{
      try{ const data = JSON.parse(ev.target.result); loadFromJSON(data); }
      catch(err){ alert('‚ö†Ô∏è index.json kh√¥ng h·ª£p l·ªá!'); }
    };
    rd.readAsText(f);
  });

  // Kh·ªüi t·∫°o tr·ªëng
  groups = []; render();
</script>
</body>
</html>
