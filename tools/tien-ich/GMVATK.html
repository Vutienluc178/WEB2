<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ§  Generator Prompt 7 Vai TrÃ² â€“ ToÃ¡n THPT</title>
  <style>
    :root{
      --bg:#0b132b; --panel:#1c2541; --accent:#5bc0be; --text:#e6f1ff; --muted:#a8b2d1; --warn:#ffd166;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial}
    header{padding:20px 24px;border-bottom:1px solid #2a335a;background:linear-gradient(180deg,#0b132b,#0b132b80)}
    header h1{margin:0;font-size:20px}
    header p{margin:6px 0 0;color:var(--muted)}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:1.1fr 1.1fr;gap:16px}
    @media (max-width:1000px){.grid{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid #2a335a;border-radius:16px;box-shadow:0 6px 20px #00000030}
    .card h2{margin:0;padding:14px 16px;border-bottom:1px solid #2a335a;font-size:16px}
    .card .body{padding:16px}
    label{display:block;margin:8px 0 6px;color:var(--muted);font-weight:600}
    input, textarea, select{width:100%;padding:12px 12px;border-radius:12px;border:1px solid #33406f;background:#0f1733;color:var(--text)}
    textarea{min-height:88px;resize:vertical}
    .row{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .row3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #2f3b69;background:#0f1733;color:var(--text);cursor:pointer;font-weight:600}
    .btn:hover{border-color:var(--accent);box-shadow:0 0 0 3px #5bc0be22}
    .btn.primary{background:var(--accent);color:#0b132b;border-color:transparent}
    .btn.ghost{background:transparent}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .muted{color:var(--muted);font-size:13px}
    details{border:1px dashed #33406f;border-radius:12px;padding:10px 12px;background:#0f1733}
    details>summary{cursor:pointer;font-weight:600;color:#e6f1ff}
    .out{font-family:var(--mono);white-space:pre-wrap;background:#0a0f25;border-radius:12px;border:1px solid #2a335a;padding:12px}
    .role{border:1px solid #32406e;border-radius:14px;padding:12px;background:#0f1733}
    .role h3{margin:0 0 8px;font-size:15px}
    .copy{float:right;font-size:12px}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#12204b;border:1px solid #2a335a;color:#a8b2d1;font-size:12px;margin-right:6px}
    .footer{padding:12px 16px;color:#8aa0d6;border-top:1px solid #2a335a}
    .check{display:inline-flex;align-items:center;gap:6px;font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>ğŸ§  Generator Prompt 7 Vai TrÃ² â€“ ToÃ¡n THPT</h1>
    <p>Táº¡o prompt gá»£i má»Ÿ & tá»•ng káº¿t bÃ i há»c toÃ¡n theo 7 vai trÃ²: SÆ° pháº¡m chiáº¿n lÆ°á»£c Â· Ká»ƒ chuyá»‡n Â· HÆ°á»›ng dáº«n thá»±c hÃ nh Â· Thiáº¿t káº¿ tÆ° duy Â· Thiáº¿t káº¿ tráº£i nghiá»‡m Â· Truyá»n cáº£m há»©ng Â· Äá»•i má»›i sá»‘.</p>
  </header>

  <div class="container">
    <div class="grid">
      <!-- INPUTS -->
      <section class="card">
        <h2>ğŸ“¥ ThÃ´ng tin Ä‘áº§u vÃ o</h2>
        <div class="body">
          <div class="row">
            <div>
              <label>Chá»§ Ä‘á» / BÃ i há»c</label>
              <input id="topic" placeholder="VÃ­ dá»¥: Há»‡ thá»©c lÆ°á»£ng trong tam giÃ¡c â€“ lá»›p 10 (CTST)" />
            </div>
            <div>
              <label>Lá»›p / Khá»‘i</label>
              <input id="grade" placeholder="VÃ­ dá»¥: 10 / 11 / 12" />
            </div>
          </div>

          <label>Má»¥c tiÃªu nÄƒng lá»±c (ngáº¯n gá»n)</label>
          <textarea id="objectives" placeholder="VÃ­ dá»¥: Giáº£i Ä‘Æ°á»£c tam giÃ¡c; Ã¡p dá»¥ng vÃ o Ä‘o Ä‘áº¡c thá»±c táº¿; trÃ¬nh bÃ y láº­p luáº­n logic."></textarea>

          <label>Ngá»¯ cáº£nh lá»›p há»c / Äiá»u kiá»‡n (tÃ¹y chá»n)</label>
          <textarea id="context" placeholder="VÃ­ dá»¥: 40 phÃºt; lá»›p 45 HS; cÃ³ mÃ¡y chiáº¿u 16:9; há»c sinh trung bÃ¬nh â€“ khÃ¡; cÃ³ Ä‘iá»‡n thoáº¡i thÃ´ng minh."></textarea>

          <div class="row">
            <div>
              <label>Giá»ng Ä‘iá»‡u (tone)</label>
              <select id="tone">
                <option value="thÃ¢n thiá»‡n, rÃµ rÃ ng, khÃ­ch lá»‡">ThÃ¢n thiá»‡n â€“ RÃµ rÃ ng â€“ KhÃ­ch lá»‡</option>
                <option value="ngáº¯n gá»n, trá»±c tiáº¿p, thá»±c dá»¥ng">Ngáº¯n gá»n â€“ Trá»±c tiáº¿p â€“ Thá»±c dá»¥ng</option>
                <option value="ká»ƒ chuyá»‡n, truyá»n cáº£m há»©ng, gáº§n gÅ©i">Ká»ƒ chuyá»‡n â€“ Truyá»n cáº£m há»©ng â€“ Gáº§n gÅ©i</option>
                <option value="chuyÃªn gia, nghiÃªm tÃºc, hÃ n lÃ¢m">ChuyÃªn gia â€“ NghiÃªm tÃºc â€“ HÃ n lÃ¢m</option>
              </select>
            </div>
            <div>
              <label>NgÃ´n ngá»¯ Ä‘áº§u ra</label>
              <select id="lang">
                <option value="vi">Tiáº¿ng Viá»‡t</option>
                <option value="en">English</option>
              </select>
            </div>
          </div>

          <div class="row3">
            <div>
              <label>Äá»™ khÃ³</label>
              <select id="level">
                <option value="cÆ¡ báº£n">CÆ¡ báº£n</option>
                <option value="trung bÃ¬nh">Trung bÃ¬nh</option>
                <option value="nÃ¢ng cao">NÃ¢ng cao</option>
              </select>
            </div>
            <div>
              <label>Thá»i lÆ°á»£ng dá»± kiáº¿n</label>
              <input id="duration" placeholder="VÃ­ dá»¥: 40 phÃºt" />
            </div>
            <div>
              <label>RÃ ng buá»™c</label>
              <input id="constraints" placeholder="VÃ­ dá»¥: báº£ng phá»¥, khÃ´ng dÃ¹ng Internet, kiá»ƒm tra nhanh 5â€™" />
            </div>
          </div>

          <details style="margin-top:10px">
            <summary>âš™ï¸ Tuá»³ chá»n nÃ¢ng cao</summary>
            <label>Äá»‹nh dáº¡ng Ä‘áº§u ra mong muá»‘n</label>
            <input id="format" placeholder="VÃ­ dá»¥: Danh sÃ¡ch 5 cÃ¢u há»i gá»£i má»Ÿ + 5 cÃ¢u tá»•ng káº¿t; kÃ¨m hoáº¡t Ä‘á»™ng ngáº¯n" />
            <label>TiÃªu chÃ­ Ä‘Ã¡nh giÃ¡ (rubric tÃ³m táº¯t)</label>
            <textarea id="rubric" placeholder="VÃ­ dá»¥: ÄÃºng cÃ´ng thá»©c (4Ä‘) Â· Láº­p luáº­n (3Ä‘) Â· á»¨ng dá»¥ng (2Ä‘) Â· TrÃ¬nh bÃ y (1Ä‘)"></textarea>
          </details>

          <div class="toolbar" style="margin-top:12px">
            <button class="btn" onclick="applyPreset('he-thuc-luong')">Máº«u: Há»‡ thá»©c lÆ°á»£ng</button>
            <button class="btn" onclick="applyPreset('dao-ham')">Máº«u: Äáº¡o hÃ m â€“ GTLN/NN</button>
            <button class="btn" onclick="applyPreset('xac-suat')">Máº«u: XÃ¡c suáº¥t</button>
          </div>

          <div class="toolbar" style="margin-top:12px">
            <button class="btn primary" onclick="generate()">ğŸš€ Táº¡o Prompt</button>
            <button class="btn" onclick="copyAll()">ğŸ“‹ Copy Táº¤T Cáº¢</button>
            <label class="check"><input type="checkbox" id="includeQA" /> Bao gá»“m cáº£ má»¥c QA</label>
            <button class="btn" onclick="downloadTxt()">ğŸ’¾ Táº£i .txt</button>
            <span class="muted" id="status"></span>
          </div>
        </div>
      </section>

      <!-- OUTPUTS -->
      <section class="card">
        <h2>ğŸ“¤ Prompt Ä‘áº§u ra (7 vai trÃ²)</h2>
        <div class="body" id="outputs">
          <p class="muted">Äiá»n thÃ´ng tin bÃªn trÃ¡i rá»“i báº¥m <b>â€œTáº¡o Promptâ€</b>. Má»—i má»¥c cÃ³ nÃºt copy riÃªng. CÃ³ thá»ƒ chá»‰nh sá»­a trÆ°á»›c khi copy.</p>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:16px">
      <h2>ğŸ§© HÆ°á»›ng dáº«n dÃ¹ng vá»›i AI</h2>
      <div class="body">
        <ol>
          <li>Äiá»n thÃ´ng tin bÃ i há»c â†’ <b>Táº¡o Prompt</b>.</li>
          <li>Copy tá»«ng prompt theo vai trÃ² hoáº·c copy táº¥t cáº£ Ä‘á»ƒ Ä‘Æ°a vÃ o AI (ChatGPT, Gemini, NotebookLMâ€¦).</li>
          <li>CÃ³ thá»ƒ yÃªu cáº§u AI: <i>â€œTáº¡o 5 cÃ¢u há»i gá»£i má»Ÿ + 5 cÃ¢u tá»•ng káº¿t, kÃ¨m 1 hoáº¡t Ä‘á»™ng váº­n dá»¥ng 5â€™ cho chá»§ Ä‘á»â€¦â€</i>.</li>
          <li>Chá»‰nh sá»­a nhanh ngay trong khung rá»“i copy láº¡i.</li>
        </ol>
        <p class="muted">Máº¹o: DÃ¹ng prompt â€œkiá»ƒm Ä‘á»‹nh cháº¥t lÆ°á»£ngâ€ á»Ÿ cuá»‘i Ä‘á»ƒ AI tá»±-Ä‘Ã¡nh-giÃ¡ Ä‘áº§u ra theo rubric.</p>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <h2>ğŸ§ª Prompt kiá»ƒm Ä‘á»‹nh cháº¥t lÆ°á»£ng (QA)</h2>
      <div class="body">
        <div class="role">
          <h3>ğŸ” Trá»ng tÃ i cháº¥t lÆ°á»£ng (Validator) <span class="pill">QA</span></h3>
          <textarea id="qa" class="out" spellcheck="false" placeholder="Sau khi nháº­n Ä‘Æ°á»£c cÃ¡c Ä‘á» xuáº¥t cÃ¢u há»i/hoáº¡t Ä‘á»™ng tá»« AI, dÃ¡n vÃ o Ä‘Ã¢y vÃ  yÃªu cáº§u: 
â€“ So khá»›p má»¥c tiÃªu â€“ Ä‘á»™ khÃ³ â€“ thá»i lÆ°á»£ng
â€“ PhÃ¡t hiá»‡n trÃ¹ng láº·p / mÆ¡ há»“ / thiáº¿u thá»±c táº¿
â€“ Sá»­a theo rubric vÃ  rÃ ng buá»™c"></textarea>
          <div class="toolbar" style="margin-top:8px">
            <button class="btn" onclick="copyEl('qa')">ğŸ“‹ Copy</button>
            <button class="btn" onclick="selectEl('qa')">ğŸ” Select</button>
          </div>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <h2>ğŸ§° Cháº©n Ä‘oÃ¡n & Kiá»ƒm thá»­</h2>
      <div class="body" id="diag">
        <div class="toolbar">
          <button class="btn" onclick="testClipboard()">ğŸ§ª Kiá»ƒm tra Clipboard API</button>
          <button class="btn" onclick="testCopyOne()">ğŸ§ª Test Copy 1 má»¥c</button>
          <button class="btn" onclick="testCopyAll()">ğŸ§ª Test Copy Táº¤T Cáº¢</button>
          <button class="btn" onclick="testBuildPrompts()">ğŸ§ª Test buildPrompts()</button>
          <button class="btn" onclick="testJoinSeparator()">ğŸ§ª Test Join Separator</button>
        </div>
        <p class="muted" id="diagLog">Káº¿t quáº£ sáº½ hiá»ƒn thá»‹ táº¡i Ä‘Ã¢y.</p>
      </div>
    </section>

    <div class="footer">Made for THPT â€“ trÃ¬nh chiáº¿u 16:9, chá»¯ lá»›n, tá»‘i Æ°u dÃ¹ng trÃªn mÃ¡y chiáº¿u & Ä‘iá»‡n thoáº¡i.</div>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);
  const outputsEl = $('outputs');
  const statusEl = $('status');
  const SEP = '\n\n\n'; // dÃ¹ng trong copyAll/downloadTxt Ä‘á»ƒ trÃ¡nh lá»—i chuá»—i xuá»‘ng dÃ²ng khÃ´ng há»£p lá»‡

  const ROLES = [
    {key:'ld', icon:'ğŸ“', name:'NhÃ  sÆ° pháº¡m chiáº¿n lÆ°á»£c', hint:'Curiosity â†’ Bridge â†’ Outcome'},
    {key:'story', icon:'ğŸ“–', name:'NhÃ  ká»ƒ chuyá»‡n toÃ¡n há»c', hint:'Ngá»¯ cáº£nh Ä‘á»i sá»‘ng â€“ nghá» nghiá»‡p'},
    {key:'coach', icon:'ğŸ› ï¸', name:'NhÃ  hÆ°á»›ng dáº«n thá»±c hÃ nh', hint:'Thá»­ â€“ Sai â€“ Kiá»ƒm chá»©ng'},
    {key:'cog', icon:'ğŸ§ ', name:'NhÃ  thiáº¿t káº¿ tÆ° duy', hint:'Scaffold â€“ Pháº£n biá»‡n â€“ Tá»± kiá»ƒm chá»©ng'},
    {key:'lxd', icon:'ğŸ§©', name:'NhÃ  thiáº¿t káº¿ tráº£i nghiá»‡m', hint:'Gamify â€“ WOW â€“ Há»£p tÃ¡c'},
    {key:'mot', icon:'â¤ï¸', name:'NgÆ°á»i truyá»n cáº£m há»©ng', hint:'GiÃ¡ trá»‹ â€“ ThÃ¡i Ä‘á»™ â€“ Ã nghÄ©a'},
    {key:'edtech', icon:'ğŸ’»', name:'NhÃ  Ä‘á»•i má»›i sá»‘', hint:'MÃ´ phá»ng â€“ Quiz â€“ AI phá»¥ tÃ¡'}
  ];

  function save(){
    const data = collect();
    localStorage.setItem('prompt7_settings', JSON.stringify(data));
  }
  function load(){
    const raw = localStorage.getItem('prompt7_settings');
    if(!raw) return;
    try{
      const d = JSON.parse(raw);
      ['topic','grade','objectives','context','tone','lang','level','duration','constraints','format','rubric'].forEach(k=>{
        if(d[k]!==undefined) $(k).value = d[k];
      });
    }catch(e){}
  }

  function collect(){
    return {
      topic: $('topic').value.trim(),
      grade: $('grade').value.trim(),
      objectives: $('objectives').value.trim(),
      context: $('context').value.trim(),
      tone: $('tone').value,
      lang: $('lang').value,
      level: $('level').value,
      duration: $('duration').value.trim(),
      constraints: $('constraints').value.trim(),
      format: $('format').value.trim(),
      rubric: $('rubric').value.trim()
    }
  }

  function applyPreset(key){
    const presets = {
      'he-thuc-luong':{
        topic:'Há»‡ thá»©c lÆ°á»£ng trong tam giÃ¡c â€“ á»©ng dá»¥ng Ä‘o Ä‘áº¡c',
        grade:'10',
        objectives:'Giáº£i Ä‘Æ°á»£c tam giÃ¡c; Ã¡p dá»¥ng Ä‘o khoáº£ng cÃ¡ch khÃ´ng Ä‘o trá»±c tiáº¿p; trÃ¬nh bÃ y láº­p luáº­n.',
        context:'40 phÃºt; lá»›p 45 HS; cÃ³ mÃ¡y chiáº¿u 16:9; trung bÃ¬nh â€“ khÃ¡.',
        duration:'40 phÃºt',
        constraints:'Kiá»ƒm tra nhanh 5â€™; khÃ´ng dÃ¹ng internet cho HS',
        format:'5 cÃ¢u má»Ÿ bÃ i + 5 cÃ¢u tá»•ng káº¿t + 1 hoáº¡t Ä‘á»™ng váº­n dá»¥ng 5â€™',
        rubric:'ÄÃºng cÃ´ng thá»©c (4) Â· Láº­p luáº­n (3) Â· á»¨ng dá»¥ng (2) Â· TrÃ¬nh bÃ y (1)'
      },
      'dao-ham':{
        topic:'Äáº¡o hÃ m â€“ tÃ¬m GTLN/GTNN á»©ng dá»¥ng tá»‘i Æ°u hoÃ¡',
        grade:'12',
        objectives:'Hiá»ƒu Ã½ nghÄ©a Ä‘áº¡o hÃ m; tÃ¬m cá»±c trá»‹; Ã¡p dá»¥ng tá»‘i Æ°u chi phÃ­ â€“ váº­t liá»‡u.',
        context:'45 phÃºt; cÃ³ GeoGebra/Desmos; HS khÃ¡.',
        duration:'45 phÃºt',
        constraints:'TrÃ¬nh chiáº¿u 16:9; káº¿t thÃºc cÃ³ exit-ticket 1â€™',
        format:'4 cÃ¢u má»Ÿ bÃ i + 4 cÃ¢u tá»•ng káº¿t + 1 tÃ¬nh huá»‘ng thá»±c táº¿',
        rubric:'Láº­p luáº­n (4) Â· ÄÃºng (3) Â· MÃ´ hÃ¬nh hoÃ¡ (2) Â· RÃµ rÃ ng (1)'
      },
      'xac-suat':{
        topic:'XÃ¡c suáº¥t â€“ mÃ´ hÃ¬nh hoÃ¡ rá»§i ro Ä‘Æ¡n giáº£n',
        grade:'11',
        objectives:'TÃ­nh xÃ¡c suáº¥t biáº¿n cá»‘ Ä‘á»™c láº­p; so sÃ¡nh chiáº¿n lÆ°á»£c ra quyáº¿t Ä‘á»‹nh.',
        context:'35â€“40 phÃºt; trÃ² chÆ¡i rÃºt thÄƒm; HS trung bÃ¬nh.',
        duration:'40 phÃºt',
        constraints:'Dá»¥ng cá»¥: tháº» mÃ u; nhÃ³m 4',
        format:'3 cÃ¢u má»Ÿ bÃ i + 5 cÃ¢u tá»•ng káº¿t + 1 mini-game',
        rubric:'KhÃ¡i niá»‡m (3) Â· TÃ­nh toÃ¡n (3) Â· Giáº£i thÃ­ch (3) Â· Há»£p tÃ¡c (1)'
      }
    };
    const p = presets[key];
    if(!p) return;
    $('topic').value = p.topic; $('grade').value=p.grade; $('objectives').value=p.objectives;
    $('context').value=p.context; $('duration').value=p.duration; $('constraints').value=p.constraints;
    $('format').value=p.format; $('rubric').value=p.rubric; status('Ãp dá»¥ng máº«u.'); save();
  }

  function tmplBase(d){
    const head = `Vai trÃ²: $ROLE$\nNgÃ´n ngá»¯: ${d.lang==='vi'?'Tiáº¿ng Viá»‡t':'English'}\nGiá»ng Ä‘iá»‡u: ${d.tone}\nBá»‘i cáº£nh: Lá»›p ${d.grade}; Thá»i lÆ°á»£ng ${d.duration||'â€”'}; Äá»™ khÃ³ ${d.level}; RÃ ng buá»™c: ${d.constraints||'â€”'}\nChá»§ Ä‘á»: ${d.topic}\nMá»¥c tiÃªu: ${d.objectives}\nÄá»‹nh dáº¡ng Ä‘áº§u ra mong muá»‘n: ${d.format||'Danh sÃ¡ch cÃ¢u há»i gá»£i má»Ÿ (má»Ÿ bÃ i) + cÃ¢u há»i tá»•ng káº¿t (váº­n dá»¥ng/reflect) + 1 hoáº¡t Ä‘á»™ng ngáº¯n'}\nRubric: ${d.rubric||'ÄÃºng kiáº¿n thá»©c â€“ Láº­p luáº­n â€“ á»¨ng dá»¥ng â€“ TrÃ¬nh bÃ y'}\n`;
    return head;
  }

  function buildPrompts(d){
    const prompts = {};

    prompts.ld = tmplBase(d) + `\nYÃŠU Cáº¦U CHUYÃŠN BIá»†T (NhÃ  sÆ° pháº¡m chiáº¿n lÆ°á»£c):\n1) Táº¡o 5 â€œcÃ¢u há»i tÃ² mÃ²â€ má»Ÿ bÃ i (Curiosity) dáº«n vÃ o ${d.topic}.\n2) Má»—i cÃ¢u cáº§n: gá»£i nhu cáº§u há»c â€“ liÃªn há»‡ thá»±c táº¿ â€“ khÃ´ng lá»™ Ä‘Ã¡p Ã¡n.\n3) Táº¡o 5 cÃ¢u há»i tá»•ng káº¿t (Transfer/Reflect) hÆ°á»›ng tá»›i á»©ng dá»¥ng thá»±c táº¿ táº¡i trÆ°á»ng/nhÃ .\n4) ThÃªm 1 hoáº¡t Ä‘á»™ng váº­n dá»¥ng 5â€™ (cáº·p/nhÃ³m 3) phÃ¹ há»£p ${d.duration}.\n5) Gá»£i Ã½ Ä‘Ã¡p Ã¡n ká»³ vá»ng (bullet).`;

    prompts.story = tmplBase(d) + `\nYÃŠU Cáº¦U CHUYÃŠN BIá»†T (NhÃ  ká»ƒ chuyá»‡n toÃ¡n há»c):\n1) Viáº¿t 1 Ä‘oáº¡n dáº«n chuyá»‡n (100â€“150 tá»«) táº¡o bá»‘i cáº£nh Ä‘á»i sá»‘ng/nghá» nghiá»‡p liÃªn quan ${d.topic}.\n2) Táº¡o 4 cÃ¢u há»i gá»£i má»Ÿ theo máº¡ch cÃ¢u chuyá»‡n (Why â†’ How â†’ What if â†’ So what).\n3) Táº¡o 4 cÃ¢u há»i tá»•ng káº¿t gáº¯n nhÃ¢n váº­t/tÃ¬nh huá»‘ng.\n4) Äá» xuáº¥t 1 hÃ¬nh áº£nh/Ä‘á»“ váº­t minh hoáº¡ dá»… tÃ¬m Ä‘á»ƒ trÃ¬nh chiáº¿u.\n5) KhÃ´ng dÃ¹ng thuáº­t ngá»¯ khÃ³ khi khÃ´ng cáº§n thiáº¿t.`;

    prompts.coach = tmplBase(d) + `\nYÃŠU Cáº¦U CHUYÃŠN BIá»†T (NhÃ  hÆ°á»›ng dáº«n thá»±c hÃ nh):\n1) Äá» xuáº¥t 1 thÃ­ nghiá»‡m/mÃ´ phá»ng mini vá»›i dá»¥ng cá»¥ ráº»/dá»… kiáº¿m.\n2) Táº¡o 3 cÃ¢u há»i kiá»ƒm chá»©ng â€“ sai á»Ÿ Ä‘Ã¢u â€“ sá»­a tháº¿ nÃ o.\n3) Táº¡o 3 cÃ¢u há»i tá»•ng káº¿t táº­p trung vÃ o quy trÃ¬nh (quan sÃ¡t â†’ giáº£ thuyáº¿t â†’ kiá»ƒm chá»©ng â†’ káº¿t luáº­n).\n4) ÄÆ°a tiÃªu chÃ­ Ä‘Ã¡nh giÃ¡ nhanh (checklist 5 má»¥c).`;

    prompts.cog = tmplBase(d) + `\nYÃŠU Cáº¦U CHUYÃŠN BIá»†T (NhÃ  thiáº¿t káº¿ tÆ° duy):\n1) Táº¡o 4 cÃ¢u há»i scaffold tÄƒng dáº§n (nháº­n biáº¿t â†’ liÃªn há»‡ â†’ khÃ¡i quÃ¡t â†’ pháº£n biá»‡n).\n2) Táº¡o 2 cÃ¢u há»i â€œnáº¿u káº¿t quáº£ saiâ€ Ä‘á»ƒ phÃ¡t hiá»‡n sai láº§m phá»• biáº¿n.\n3) Táº¡o 2 cÃ¢u há»i â€œkhÃ¡i quÃ¡t hoÃ¡â€ Ä‘á»ƒ rÃºt quy táº¯c.\n4) Xuáº¥t 1 báº£ng KWL rá»—ng phÃ¹ há»£p chá»§ Ä‘á» Ä‘á»ƒ há»c sinh Ä‘iá»n nhanh.`;

    prompts.lxd = tmplBase(d) + `\nYÃŠU Cáº¦U CHUYÃŠN BIá»†T (NhÃ  thiáº¿t káº¿ tráº£i nghiá»‡m):\n1) Äá» xuáº¥t 1 hoáº¡t Ä‘á»™ng gamified (Ä‘iá»ƒm, huy hiá»‡u, vai trÃ² nhÃ³m).\n2) Táº¡o 3 cÃ¢u há»i gá»£i má»Ÿ dáº¡ng thá»­ thÃ¡ch thá»i gian.\n3) Táº¡o 3 cÃ¢u há»i tá»•ng káº¿t kiá»ƒu â€œhÃ¹ng biá»‡n 30s / exit-ticketâ€.\n4) ThÃªm 1 khoáº£nh kháº¯c WOW (mÃ´ phá»ng/áº£o giÃ¡c toÃ¡n há»c/GeoGebra).`;

    prompts.mot = tmplBase(d) + `\nYÃŠU Cáº¦U CHUYÃŠN BIá»†T (NgÆ°á»i truyá»n cáº£m há»©ng):\n1) Viáº¿t 3 cÃ¢u má»Ÿ bÃ i truyá»n cáº£m há»©ng (â‰¤30 tá»«/cÃ¢u).\n2) Viáº¿t 3 cÃ¢u há»i tá»•ng káº¿t gáº¯n giÃ¡ trá»‹ sá»‘ng â€“ thÃ¡i Ä‘á»™ há»c táº­p.\n3) Viáº¿t 1 thÃ´ng Ä‘iá»‡p káº¿t thÃºc 2 cÃ¢u, dá»… nhá»›, gáº§n gÅ©i.\n4) KhÃ´ng lÃªn gÃ¢n; Æ°u tiÃªn thÃ¢n thiá»‡n, tÃ´n trá»ng HS.`;

    prompts.edtech = tmplBase(d) + `\nYÃŠU Cáº¦U CHUYÃŠN BIá»†T (NhÃ  Ä‘á»•i má»›i sá»‘):\n1) Gá»£i Ã½ 1 mÃ´ phá»ng (GeoGebra/Desmos) vÃ  1 quiz nhanh (4 cÃ¢u).\n2) Táº¡o 3 cÃ¢u há»i gá»£i má»Ÿ dá»±a trÃªn mÃ´ phá»ng Ä‘á»™ng.\n3) Táº¡o 3 cÃ¢u há»i tá»•ng káº¿t kÃ¨m â€œexit-ticketâ€ Google Form (mÃ´ táº£ cÃ¢u há»i).\n4) Gá»£i Ã½ cÃ¡ch dÃ¹ng AI nhÆ° trá»£ giáº£ng: kiá»ƒm tra bÆ°á»›c giáº£i, gá»£i Ã½ nháº¹, khÃ´ng cho Ä‘Ã¡p Ã¡n ngay.`;

    return prompts;
  }

  function render(prompts){
    outputsEl.innerHTML = '';
    for(const role of ROLES){
      const key = role.key; const txt = prompts[key]||'';
      const id = 'out_'+key;
      const wrap = document.createElement('div');
      wrap.className='role';
      wrap.innerHTML = `
        <h3>${role.icon} ${role.name} <span class="pill">${role.hint}</span>
          <button class="btn copy" onclick="copyEl('${id}')">Copy</button>
          <button class="btn copy" onclick="selectEl('${id}')">Select</button>
        </h3>
        <textarea id="${id}" class="out" spellcheck="false">${txt}</textarea>
      `;
      outputsEl.appendChild(wrap);
    }
  }

  function generate(){
    const d = collect();
    if(!d.topic){ status('âš ï¸ Vui lÃ²ng nháº­p â€œChá»§ Ä‘á»/BÃ i há»câ€.'); return; }
    const prompts = buildPrompts(d);
    render(prompts); save(); status('ÄÃ£ táº¡o prompt theo 7 vai trÃ².');
  }

  // ===== Clipboard helpers with robust fallbacks =====
  function canUseModernClipboard(){
    return typeof navigator!=='undefined' && !!navigator.clipboard && window.isSecureContext === true;
  }

  async function safeWriteClipboard(text){
    // Try modern API first (in user gesture context)
    if(canUseModernClipboard()){
      try {
        await navigator.clipboard.writeText(text);
        return {ok:true, method:'navigator.clipboard'};
      } catch(err){
        // fallthrough to legacy path
      }
    }
    // Legacy fallback: temporary textarea + execCommand('copy')
    try{
      const ta = document.createElement('textarea');
      ta.value = text; ta.setAttribute('readonly','');
      ta.style.position='fixed'; ta.style.top='-9999px';
      document.body.appendChild(ta); ta.select(); ta.setSelectionRange(0, ta.value.length);
      const ok = document.execCommand && document.execCommand('copy');
      document.body.removeChild(ta);
      if(ok){ return {ok:true, method:'execCommand'}; }
    }catch(err){ /* ignore */ }
    return {ok:false};
  }

  function selectEl(id){
    const el = $(id); if(!el) return;
    el.focus(); el.select(); el.setSelectionRange(0, el.value.length);
    status('ÄÃ£ bÃ´i Ä‘en vÄƒn báº£n â€“ nháº¥n Ctrl/Cmd+C Ä‘á»ƒ sao chÃ©p.');
  }

  async function copyEl(id){
    const v = $(id).value;
    const res = await safeWriteClipboard(v);
    if(res.ok){
      status('ÄÃ£ copy vÃ o clipboard. ('+res.method+')');
    } else {
      selectEl(id);
      status('âš ï¸ TrÃ¬nh duyá»‡t cháº·n Clipboard. ÄÃ£ bÃ´i Ä‘en â€“ nháº¥n Ctrl/Cmd+C Ä‘á»ƒ copy.');
    }
  }

  async function copyAll(){
    const ta = outputsEl.querySelectorAll('textarea');
    const includeQA = $('includeQA')?.checked;
    const qaText = includeQA ? ($('qa')?.value || '') : '';
    if(!ta.length && !qaText){ status('ChÆ°a cÃ³ ná»™i dung Ä‘á»ƒ copy.'); return; }
    const all = [ ...Array.from(ta).map(t=>t.value), qaText ].filter(Boolean).join(SEP);
    const res = await safeWriteClipboard(all);
    if(res.ok){
      status('ÄÃ£ copy Táº¤T Cáº¢ vÃ o clipboard. ('+res.method+')');
    } else {
      // create a hidden blob anchor as another fallback path for environments that block clipboard
      const blob = new Blob([all], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'prompt-7-vai-tro.txt';
      a.click(); URL.revokeObjectURL(url);
      status('âš ï¸ Clipboard bá»‹ cháº·n. ÄÃ£ tá»± Ä‘á»™ng táº£i .txt thay tháº¿.');
    }
  }

  function downloadTxt(){
    const ta = outputsEl.querySelectorAll('textarea');
    const includeQA = $('includeQA')?.checked;
    const qaText = includeQA ? ($('qa')?.value || '') : '';
    if(!ta.length && !qaText){ status('ChÆ°a cÃ³ ná»™i dung Ä‘á»ƒ táº£i.'); return; }
    const all = [ ...Array.from(ta).map(t=>t.value), qaText ].filter(Boolean).join(SEP);
    const blob = new Blob([all], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'prompt-7-vai-tro.txt'; a.click(); URL.revokeObjectURL(url);
  }
  function status(msg){ statusEl.textContent = msg; setTimeout(()=>statusEl.textContent='', 4000); }

  // ===== Diagnostics / Testcases =====
  function log(msg){ const el = document.getElementById('diagLog'); if(el) el.textContent = msg; }

  async function testClipboard(){
    const canModern = canUseModernClipboard();
    let note = `SecureContext: ${window.isSecureContext} Â· ModernAPI: ${canModern}`;
    // attempt a harmless write
    const res = await safeWriteClipboard('TEST_CLIPBOARD_'+Date.now());
    note += res.ok ? ' Â· Write: OK ('+res.method+')' : ' Â· Write: BLOCKED (fall back to Select/Ctrl+C hoáº·c Táº£i .txt)';
    log(note);
  }
  async function testCopyOne(){
    // create a temporary textarea and try copy via helper
    const tmp = 'TEST_ONE_'+Date.now();
    const res = await safeWriteClipboard(tmp);
    log(res.ok ? 'Copy 1 má»¥c: OK ('+res.method+')' : 'Copy 1 má»¥c: BLOCKED');
  }
  async function testCopyAll(){
    const res = await safeWriteClipboard('TEST_ALL_'+Date.now());
    log(res.ok ? 'Copy táº¥t cáº£: OK ('+res.method+')' : 'Copy táº¥t cáº£: BLOCKED');
  }

  // New tests to catch the earlier SyntaxError
  function testBuildPrompts(){
    try{
      const d = {topic:'Test', grade:'10', objectives:'Obj', context:'Ctx', tone:'thÃ¢n thiá»‡n', lang:'vi', level:'cÆ¡ báº£n', duration:'40 phÃºt', constraints:'-', format:'-', rubric:'-'};
      const p = buildPrompts(d);
      const keysOk = ['ld','story','coach','cog','lxd','mot','edtech'].every(k=>typeof p[k]==='string' && p[k].length>10);
      log(keysOk ? 'buildPrompts(): OK' : 'buildPrompts(): FAIL');
    }catch(e){ log('buildPrompts(): ERROR '+e.message); }
  }
  function testJoinSeparator(){
    try{
      const joined = ['A','B','C'].join(SEP);
      const ok = joined.indexOf('\n\n\n')>0 && !/\r/.test(joined);
      log(ok ? 'Join Separator: OK' : 'Join Separator: FAIL');
    }catch(e){ log('Join Separator: ERROR '+e.message); }
  }

  load();
</script>
</body>
</html>
